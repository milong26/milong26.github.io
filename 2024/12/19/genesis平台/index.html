<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhon.fun","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个比robosuite更简洁的物理平台，专为通用机器人&#x2F;人工智能&#x2F;物理AI应用而设计。">
<meta property="og:type" content="article">
<meta property="og:title" content="genesis平台">
<meta property="og:url" content="http://zhon.fun/2024/12/19/genesis%E5%B9%B3%E5%8F%B0/index.html">
<meta property="og:site_name" content="没啥标题">
<meta property="og:description" content="一个比robosuite更简洁的物理平台，专为通用机器人&#x2F;人工智能&#x2F;物理AI应用而设计。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-12-19T06:51:53.000Z">
<meta property="article:modified_time" content="2025-02-16T14:09:32.223Z">
<meta property="article:author" content="milong26">
<meta property="article:tag" content="robotic">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://zhon.fun/2024/12/19/genesis%E5%B9%B3%E5%8F%B0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://zhon.fun/2024/12/19/genesis%E5%B9%B3%E5%8F%B0/","path":"2024/12/19/genesis平台/","title":"genesis平台"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>genesis平台 | 没啥标题</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">没啥标题</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">活下去</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#install"><span class="nav-number">1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">基础使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B"><span class="nav-number">2.1.</span> <span class="nav-text">开始</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">可视化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6robot"><span class="nav-number">2.3.</span> <span class="nav-text">控制robot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6%E4%B8%8E%E8%BF%90%E5%8A%A8%E8%A7%84%E5%88%92"><span class="nav-number">2.4.</span> <span class="nav-text">逆运动学与运动规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95"><span class="nav-number">2.5.</span> <span class="nav-text">调试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#entity"><span class="nav-number">3.</span> <span class="nav-text">entity</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E4%BD%93%E6%A8%A1%E5%9E%8B"><span class="nav-number">3.1.</span> <span class="nav-text">物体模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E6%A8%A1%E5%9E%8B"><span class="nav-number">3.1.1.</span> <span class="nav-text">内部模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#xmlmjcf"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">xml(MJCF)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#urdf"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">urdf</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E5%AF%BC%E5%85%A5"><span class="nav-number">3.1.2.</span> <span class="nav-text">外部导入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C"><span class="nav-number">4.</span> <span class="nav-text">操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="nav-number">4.1.</span> <span class="nav-text">控制的基本流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%8E%E4%B9%88%E9%93%BE%E6%8E%A5%E5%88%B0%E5%AF%B9%E5%BA%94%E5%85%B3%E8%8A%82"><span class="nav-number">4.2.</span> <span class="nav-text">怎么链接到对应关节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#franka_emika_panda%E7%9A%84panda"><span class="nav-number">4.2.1.</span> <span class="nav-text">franka_emika_panda的panda</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#franka_simbi-franka_panda"><span class="nav-number">4.2.2.</span> <span class="nav-text">franka_sim&#x2F;bi-franka_panda</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A9robot%E4%BF%9D%E6%8C%81%E9%9D%99%E6%AD%A2"><span class="nav-number">4.3.</span> <span class="nav-text">让robot保持静止</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A9%E5%8A%A8%E4%BD%9C%E6%9B%B4%E5%8A%A0%E5%B9%B3%E7%BC%93"><span class="nav-number">4.4.</span> <span class="nav-text">让动作更加平缓</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BD%95%E5%83%8F"><span class="nav-number">5.</span> <span class="nav-text">录像</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">milong26</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhon.fun/2024/12/19/genesis%E5%B9%B3%E5%8F%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="milong26">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="没啥标题">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="genesis平台 | 没啥标题">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          genesis平台
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-19 14:51:53" itemprop="dateCreated datePublished" datetime="2024-12-19T14:51:53+08:00">2024-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-02-16 22:09:32" itemprop="dateModified" datetime="2025-02-16T22:09:32+08:00">2025-02-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/it/" itemprop="url" rel="index"><span itemprop="name">it</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>一个比robosuite更简洁的物理平台，专为通用机器人/人工智能/物理AI应用而设计。</p>
<span id="more"></span>
<p><a
target="_blank" rel="noopener" href="https://genesis-world.readthedocs.io/en/latest/index.html">教程</a></p>
<h1 id="install">install</h1>
<ol type="1">
<li>安装相关软件
<ol type="1">
<li>anaconda3</li>
<li>git</li>
</ol></li>
<li>需求：
<ol type="1">
<li>Python: 3.9+
所以我<code>conda create -n genesis python==3.10</code></li>
<li>OS: Linux (recommended) / MacOS / Windows 但windows不太方便。</li>
</ol></li>
<li>~~<code>pip install genesis-world</code> ~~
因为这个项目还在即时更新，建议用github clone方式安装
<ol type="1">
<li><code>git clone https://github.com/Genesis-Embodied-AI/Genesis.git</code></li>
<li>进入Genesis目录，<code>pip install -e .</code></li>
<li><code>export PYTHONPATH=~/work/Genesis</code>
这个是修改python路径的，不是永久的。</li>
<li>如果需要经常使用的话
<ol type="1">
<li><code>vim ~/.bashrc</code></li>
<li>加入<code>export PYTHONPATH=~/Genesis:$PYTHONPATH</code>保存</li>
</ol></li>
<li>在work里创建一个文件夹写代码。可以调用Genesis下面的genesis</li>
</ol></li>
<li>检查cuda<code>nvidia-smi</code></li>
<li>安装<a target="_blank" rel="noopener" href="https://pytorch.org/get-started/locally/">pytorch</a>
<ol type="1">
<li>我检查到cuda版本是11.6，就下载的pip3 install torch torchvision
torchaudio --index-url
https://download.pytorch.org/whl/cu118。可能以后要改</li>
</ol></li>
<li>以上就是最基础的安装，还有一些额外的根据需求安装即可</li>
<li>更新：因为genesis还在更新中，偶尔需要更新
<ol type="1">
<li><del><code>python -m pip install --upgrade pip</code></del></li>
<li><del><code>pip install --upgrade 包名称</code></del></li>
<li>在Genesis里<code>git pull</code></li>
</ol></li>
<li>设置显示器
<ol type="1">
<li>https://blog.csdn.net/Stone_hello/article/details/120041495</li>
<li>https://www.cnblogs.com/SkyXZ/p/18687026</li>
</ol></li>
</ol>
<h1 id="基础使用">基础使用</h1>
<h2 id="开始">开始</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> genesis <span class="keyword">as</span> gs</span><br><span class="line"><span class="comment"># 初始化</span></span><br><span class="line">gs.init(</span><br><span class="line">    seed                = <span class="literal">None</span>,</span><br><span class="line">    precision           = <span class="string">&#x27;32&#x27;</span>,</span><br><span class="line">    debug               = <span class="literal">False</span>,</span><br><span class="line">    eps                 = <span class="number">1e-12</span>,</span><br><span class="line">    logging_level       = <span class="string">&#x27;warning&#x27;</span>,</span><br><span class="line">    <span class="comment"># logging_level       = None,</span></span><br><span class="line">    backend             = gs.cpu,</span><br><span class="line">    theme               = <span class="string">&#x27;light&#x27;</span>,</span><br><span class="line">    logger_verbose_time = <span class="literal">False</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 场景包装一个模拟器对象（处理所有底层物理解算器）和一个可视化工具对象</span></span><br><span class="line">scene = gs.Scene(</span><br><span class="line">    sim_options=gs.options.SimOptions(</span><br><span class="line">        dt=<span class="number">0.01</span>,</span><br><span class="line">        gravity=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0</span>),</span><br><span class="line">    ),</span><br><span class="line">    show_viewer=<span class="literal">True</span>,</span><br><span class="line">    <span class="comment"># camera_fov</span></span><br><span class="line">    viewer_options = gs.options.ViewerOptions(</span><br><span class="line">        res           = (<span class="number">1280</span>, <span class="number">960</span>),</span><br><span class="line">        camera_pos    = (<span class="number">3.5</span>, <span class="number">0.0</span>, <span class="number">2.5</span>),</span><br><span class="line">        camera_lookat = (<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.5</span>),</span><br><span class="line">        camera_fov    = <span class="number">40</span>,</span><br><span class="line">        max_FPS       = <span class="number">60</span>,</span><br><span class="line">    ),</span><br><span class="line">    vis_options = gs.options.VisOptions(</span><br><span class="line">        show_world_frame = <span class="literal">True</span>, <span class="comment"># visualize the coordinate frame of `world` at its origin</span></span><br><span class="line">        world_frame_size = <span class="number">1.0</span>, <span class="comment"># length of the world frame in meter</span></span><br><span class="line">        show_link_frame  = <span class="literal">False</span>, <span class="comment"># do not visualize coordinate frames of entity links</span></span><br><span class="line">        show_cameras     = <span class="literal">False</span>, <span class="comment"># do not visualize mesh and frustum of the cameras added</span></span><br><span class="line">        plane_reflection = <span class="literal">True</span>, <span class="comment"># turn on plane reflection</span></span><br><span class="line">        ambient_light    = (<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>), <span class="comment"># ambient light setting</span></span><br><span class="line">    ),</span><br><span class="line">    renderer = gs.renderers.Rasterizer(), <span class="comment"># using rasterizer for camera rendering</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># load object</span></span><br><span class="line"><span class="comment"># 在创建变形时，您还可以指定其位置、方向、大小等。对于方向，变形接受eXtreme（scipy外部x-y-z约定）或quat（w-x-y-z约定）。</span></span><br><span class="line">plane = scene.add_entity(</span><br><span class="line">    gs.morphs.Plane()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">franka = scene.add_entity(</span><br><span class="line">    gs.morphs.MJCF(</span><br><span class="line">        file  = <span class="string">&#x27;xml/franka_emika_panda/panda.xml&#x27;</span>,</span><br><span class="line">        pos   = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">        euler = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">45</span>), <span class="comment"># we follow scipy&#x27;s extrinsic x-y-z rotation convention, in degrees,</span></span><br><span class="line">        <span class="comment">#     # quat  = (1.0, 0.0, 0.0, 0.0), # we use w-x-y-z convention for quaternions,</span></span><br><span class="line">        scale = <span class="number">1</span>,</span><br><span class="line">    ),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scene.build()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行多久全看这个range？没有自己退出的功能？</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">    scene.step()</span><br></pre></td></tr></table></figure>
<p>分析</p>
<ol type="1">
<li>导入genesis并初始化</li>
<li>创建场景Scene：一个场景包含一个simulator对象，处理所有底层物理求解器，以及一个visualizer对象，管理与可视化相关的概念。创建场景时，可以配置各种物理求解器参数。</li>
<li>将对象加载到场景中，所有对象和机器人都表示为Entity，Genesis设计为完全面向对象：用scene.add_entity</li>
<li>构建场景并开始模拟：scene.build() 和 step</li>
</ol>
<h2 id="可视化">可视化</h2>
<p>设置相机参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> genesis <span class="keyword">as</span> gs</span><br><span class="line"></span><br><span class="line">gs.init(backend=gs.cpu)</span><br><span class="line"></span><br><span class="line">scene = gs.Scene(</span><br><span class="line">    show_viewer = <span class="literal">True</span>,</span><br><span class="line">    viewer_options = gs.options.ViewerOptions(</span><br><span class="line">        res           = (<span class="number">1280</span>, <span class="number">960</span>),</span><br><span class="line">        camera_pos    = (<span class="number">3.5</span>, <span class="number">0.0</span>, <span class="number">2.5</span>),</span><br><span class="line">        camera_lookat = (<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.5</span>),</span><br><span class="line">        camera_fov    = <span class="number">40</span>,</span><br><span class="line">        max_FPS       = <span class="number">60</span>,</span><br><span class="line">    ),</span><br><span class="line">    vis_options = gs.options.VisOptions(</span><br><span class="line">        show_world_frame = <span class="literal">True</span>,</span><br><span class="line">        world_frame_size = <span class="number">1.0</span>,</span><br><span class="line">        show_link_frame  = <span class="literal">False</span>,</span><br><span class="line">        show_cameras     = <span class="literal">False</span>,</span><br><span class="line">        plane_reflection = <span class="literal">True</span>,</span><br><span class="line">        ambient_light    = (<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>),</span><br><span class="line">    ),</span><br><span class="line">    renderer=gs.renderers.Rasterizer(),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">plane = scene.add_entity(</span><br><span class="line">    gs.morphs.Plane(),</span><br><span class="line">)</span><br><span class="line">franka = scene.add_entity(</span><br><span class="line">    gs.morphs.MJCF(file=<span class="string">&#x27;xml/franka_emika_panda/panda.xml&#x27;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cam = scene.add_camera(</span><br><span class="line">    res    = (<span class="number">640</span>, <span class="number">480</span>),</span><br><span class="line">    pos    = (<span class="number">3.5</span>, <span class="number">0.0</span>, <span class="number">2.5</span>),</span><br><span class="line">    lookat = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>),</span><br><span class="line">    fov    = <span class="number">30</span>,</span><br><span class="line">    GUI    = <span class="literal">False</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">scene.build()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 渲染rgb、深度、分割掩码和法线图</span></span><br><span class="line"><span class="comment"># rgb, depth, segmentation, normal = cam.render(rgb=True, depth=True, segmentation=True, normal=True)</span></span><br><span class="line"></span><br><span class="line">cam.start_recording()</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">120</span>):</span><br><span class="line">    scene.step()</span><br><span class="line">    cam.set_pose(</span><br><span class="line">        pos    = (<span class="number">3.0</span> * np.sin(i / <span class="number">60</span>), <span class="number">3.0</span> * np.cos(i / <span class="number">60</span>), <span class="number">2.5</span>),</span><br><span class="line">        lookat = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>),</span><br><span class="line">    )</span><br><span class="line">    cam.render()</span><br><span class="line">cam.stop_recording(save_to_filename=<span class="string">&#x27;video.mp4&#x27;</span>, fps=<span class="number">60</span>)</span><br></pre></td></tr></table></figure>
<h2 id="控制robot">控制robot</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> genesis <span class="keyword">as</span> gs</span><br><span class="line"></span><br><span class="line"><span class="comment">########################## 初始化 ##########################</span></span><br><span class="line">gs.init(backend=gs.cpu)</span><br><span class="line"></span><br><span class="line"><span class="comment">########################## 创建场景 ##########################</span></span><br><span class="line">scene = gs.Scene(</span><br><span class="line">    viewer_options = gs.options.ViewerOptions(</span><br><span class="line">        camera_pos    = (<span class="number">0</span>, -<span class="number">3.5</span>, <span class="number">2.5</span>),</span><br><span class="line">        camera_lookat = (<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.5</span>),</span><br><span class="line">        camera_fov    = <span class="number">30</span>,</span><br><span class="line">        res           = (<span class="number">960</span>, <span class="number">640</span>),</span><br><span class="line">        max_FPS       = <span class="number">60</span>,</span><br><span class="line">    ),</span><br><span class="line">    sim_options = gs.options.SimOptions(</span><br><span class="line">        dt = <span class="number">0.01</span>,</span><br><span class="line">    ),</span><br><span class="line">    show_viewer = <span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">########################## 实体 ##########################</span></span><br><span class="line">plane = scene.add_entity(</span><br><span class="line">    gs.morphs.Plane(),</span><br><span class="line">)</span><br><span class="line">franka = scene.add_entity(</span><br><span class="line">    gs.morphs.MJCF(</span><br><span class="line">        file  = <span class="string">&#x27;xml/franka_emika_panda/panda.xml&#x27;</span>,</span><br><span class="line">    ),</span><br><span class="line">)</span><br><span class="line"><span class="comment">########################## 构建 ##########################</span></span><br><span class="line">scene.build()</span><br><span class="line"></span><br><span class="line">jnt_names = [</span><br><span class="line">    <span class="string">&#x27;joint1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;joint2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;joint3&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;joint4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;joint5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;joint6&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;joint7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;finger_joint1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;finger_joint2&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">dofs_idx = [franka.get_joint(name).dof_idx_local <span class="keyword">for</span> name <span class="keyword">in</span> jnt_names]</span><br><span class="line"></span><br><span class="line"><span class="comment">############ 可选：设置控制增益 ############</span></span><br><span class="line"><span class="comment"># 设置位置增益</span></span><br><span class="line">franka.set_dofs_kp(</span><br><span class="line">    kp             = np.array([<span class="number">4500</span>, <span class="number">4500</span>, <span class="number">3500</span>, <span class="number">3500</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">100</span>, <span class="number">100</span>]),</span><br><span class="line">    dofs_idx_local = dofs_idx,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 设置速度增益</span></span><br><span class="line">franka.set_dofs_kv(</span><br><span class="line">    kv             = np.array([<span class="number">450</span>, <span class="number">450</span>, <span class="number">350</span>, <span class="number">350</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">10</span>, <span class="number">10</span>]),</span><br><span class="line">    dofs_idx_local = dofs_idx,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 设置安全的力范围</span></span><br><span class="line">franka.set_dofs_force_range(</span><br><span class="line">    lower          = np.array([-<span class="number">87</span>, -<span class="number">87</span>, -<span class="number">87</span>, -<span class="number">87</span>, -<span class="number">12</span>, -<span class="number">12</span>, -<span class="number">12</span>, -<span class="number">100</span>, -<span class="number">100</span>]),</span><br><span class="line">    upper          = np.array([ <span class="number">87</span>,  <span class="number">87</span>,  <span class="number">87</span>,  <span class="number">87</span>,  <span class="number">12</span>,  <span class="number">12</span>,  <span class="number">12</span>,  <span class="number">100</span>,  <span class="number">100</span>]),</span><br><span class="line">    dofs_idx_local = dofs_idx,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 硬重置</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">150</span>):</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="number">50</span>:</span><br><span class="line">        franka.set_dofs_position(np.array([<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.04</span>, <span class="number">0.04</span>]), dofs_idx)</span><br><span class="line">    <span class="keyword">elif</span> i &lt; <span class="number">100</span>:</span><br><span class="line">        franka.set_dofs_position(np.array([-<span class="number">1</span>, <span class="number">0.8</span>, <span class="number">1</span>, -<span class="number">2</span>, <span class="number">1</span>, <span class="number">0.5</span>, -<span class="number">0.5</span>, <span class="number">0.04</span>, <span class="number">0.04</span>]), dofs_idx)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        franka.set_dofs_position(np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]), dofs_idx)</span><br><span class="line"></span><br><span class="line">    scene.step()</span><br><span class="line"></span><br><span class="line"><span class="comment"># PD控制</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1250</span>):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">        franka.control_dofs_position(</span><br><span class="line">            np.array([<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.04</span>, <span class="number">0.04</span>]),</span><br><span class="line">            dofs_idx,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">elif</span> i == <span class="number">250</span>:</span><br><span class="line">        franka.control_dofs_position(</span><br><span class="line">            np.array([-<span class="number">1</span>, <span class="number">0.8</span>, <span class="number">1</span>, -<span class="number">2</span>, <span class="number">1</span>, <span class="number">0.5</span>, -<span class="number">0.5</span>, <span class="number">0.04</span>, <span class="number">0.04</span>]),</span><br><span class="line">            dofs_idx,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">elif</span> i == <span class="number">500</span>:</span><br><span class="line">        franka.control_dofs_position(</span><br><span class="line">            np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]),</span><br><span class="line">            dofs_idx,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">elif</span> i == <span class="number">750</span>:</span><br><span class="line">        <span class="comment"># 用速度控制第一个自由度，其余的用位置控制</span></span><br><span class="line">        franka.control_dofs_position(</span><br><span class="line">            np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])[<span class="number">1</span>:],</span><br><span class="line">            dofs_idx[<span class="number">1</span>:],</span><br><span class="line">        )</span><br><span class="line">        franka.control_dofs_velocity(</span><br><span class="line">            np.array([<span class="number">1.0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])[:<span class="number">1</span>],</span><br><span class="line">            dofs_idx[:<span class="number">1</span>],</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">elif</span> i == <span class="number">1000</span>:</span><br><span class="line">        franka.control_dofs_force(</span><br><span class="line">            np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]),</span><br><span class="line">            dofs_idx,</span><br><span class="line">        )</span><br><span class="line">    <span class="comment"># 这是根据给定控制命令计算的控制力</span></span><br><span class="line">    <span class="comment"># 如果使用力控制，它与给定的控制命令相同</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;控制力:&#x27;</span>, franka.get_dofs_control_force(dofs_idx))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这是自由度实际经历的力</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;内部力:&#x27;</span>, franka.get_dofs_force(dofs_idx))</span><br><span class="line"></span><br><span class="line">    scene.step()</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>从第0步到第500步，我们使用位置控制来控制所有自由度，并依次将机器人移动到3个目标位置。注意，对于control_*API，一旦设置了目标值，它将被内部存储，你不需要在接下来的步骤中重复发送命令，只要你的目标保持不变。</li>
<li>在第750步，我们展示了可以对不同的自由度进行混合控制：对于第一个自由度（自由度0），我们发送一个速度命令，而其余的仍然遵循位置控制命令。</li>
<li>在第1000步，我们切换到扭矩（力）控制，并向所有自由度发送一个零力命令，机器人将再次因重力而掉落到地面。</li>
</ol>
<h2 id="逆运动学与运动规划">逆运动学与运动规划</h2>
<p>如何在Genesis中使用逆运动学（IK）和运动规划，并执行一个简单的抓取任务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">创建一个场景，加载你喜欢的机械臂和一个小立方体，构建场景，然后设置控制增益：</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import numpy as np</span><br><span class="line">import genesis as gs</span><br><span class="line"></span><br><span class="line">########################## 初始化 ##########################</span><br><span class="line">gs.init(backend=gs.cpu,theme=&#x27;light&#x27;)</span><br><span class="line"></span><br><span class="line">########################## 创建场景 ##########################</span><br><span class="line">scene = gs.Scene(</span><br><span class="line">    viewer_options = gs.options.ViewerOptions(</span><br><span class="line">        camera_pos    = (3, -1, 1.5),</span><br><span class="line">        camera_lookat = (0.0, 0.0, 0.5),</span><br><span class="line">        camera_fov    = 30,</span><br><span class="line">        max_FPS       = 60,</span><br><span class="line">    ),</span><br><span class="line">    sim_options = gs.options.SimOptions(</span><br><span class="line">        dt = 0.01,</span><br><span class="line">        substeps = 4, # 为了更稳定的抓取接触</span><br><span class="line">    ),</span><br><span class="line">    show_viewer = True,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">########################## 实体 ##########################</span><br><span class="line">plane = scene.add_entity(</span><br><span class="line">    gs.morphs.Plane(),</span><br><span class="line">)</span><br><span class="line">cube = scene.add_entity(</span><br><span class="line">    gs.morphs.Box(</span><br><span class="line">        size = (0.04, 0.04, 0.04),</span><br><span class="line">        pos  = (0.65, 0.0, 0.02),</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">franka = scene.add_entity(</span><br><span class="line">    gs.morphs.MJCF(file=&#x27;xml/franka_emika_panda/panda.xml&#x27;),</span><br><span class="line">)</span><br><span class="line">########################## 构建 ##########################</span><br><span class="line">scene.build()</span><br><span class="line"></span><br><span class="line">motors_dof = np.arange(7)</span><br><span class="line">fingers_dof = np.arange(7, 9)</span><br><span class="line"></span><br><span class="line"># 设置控制增益</span><br><span class="line"># 注意：以下值是为实现Franka最佳行为而调整的</span><br><span class="line"># 通常，每个新机器人都会有一组不同的参数。</span><br><span class="line"># 有时高质量的URDF或XML文件也会提供这些参数，并会被解析。</span><br><span class="line">franka.set_dofs_kp(</span><br><span class="line">    np.array([4500, 4500, 3500, 3500, 2000, 2000, 2000, 100, 100]),</span><br><span class="line">)</span><br><span class="line">franka.set_dofs_kv(</span><br><span class="line">    np.array([450, 450, 350, 350, 200, 200, 200, 10, 10]),</span><br><span class="line">)</span><br><span class="line">franka.set_dofs_force_range(</span><br><span class="line">    np.array([-87, -87, -87, -87, -12, -12, -12, -100, -100]),</span><br><span class="line">    np.array([ 87,  87,  87,  87,  12,  12,  12,  100,  100]),</span><br><span class="line">)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">接下来，让我们将机器人的末端执行器移动到预抓取姿态。这分两步完成：</span><br><span class="line"></span><br><span class="line">    使用IK求解给定目标末端执行器姿态的关节位置</span><br><span class="line"></span><br><span class="line">    使用运动规划器到达目标位置</span><br><span class="line"></span><br><span class="line">Genesis中的运动规划使用OMPL库。你可以按照安装页面中的说明进行安装。</span><br><span class="line"></span><br><span class="line">在Genesis中，IK和运动规划非常简单：每个都可以通过一个函数调用完成。</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># 获取末端执行器链接</span><br><span class="line">end_effector = franka.get_link(&#x27;hand&#x27;)</span><br><span class="line"></span><br><span class="line"># 移动到预抓取姿态</span><br><span class="line">qpos = franka.inverse_kinematics(</span><br><span class="line">    link = end_effector,</span><br><span class="line">    pos  = np.array([0.65, 0.0, 0.25]),</span><br><span class="line">    quat = np.array([0, 1, 0, 0]),</span><br><span class="line">)</span><br><span class="line"># 夹爪打开位置</span><br><span class="line">qpos[-2:] = 0.04</span><br><span class="line">path = franka.plan_path(</span><br><span class="line">    qpos_goal     = qpos,</span><br><span class="line">    num_waypoints = 200, # 2秒持续时间</span><br><span class="line">)</span><br><span class="line"># 执行规划路径</span><br><span class="line">for waypoint in path:</span><br><span class="line">    franka.control_dofs_position(waypoint)</span><br><span class="line">    scene.step()</span><br><span class="line"></span><br><span class="line"># 让机器人到达最后一个路径点</span><br><span class="line">for i in range(100):</span><br><span class="line">    scene.step()</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">如你所见，IK求解和运动规划都是机器人实体的两个集成方法。对于IK求解，你只需告诉机器人的IK求解器哪个链接是末端执行器，并指定目标姿态。然后，你告诉运动规划器目标关节位置（qpos），它会返回一个规划和平滑的路径点列表。注意，在我们执行路径后，我们让控制器再运行100步。这是因为我们使用的是PD控制器，目标位置和当前实际位置之间会有一个差距。因此，我们让控制器多运行一段时间，以便机器人能够到达规划轨迹的最后一个路径点。</span><br><span class="line"></span><br><span class="line">接下来，我们将机器人夹爪向下移动，抓取立方体并将其抬起：</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"># 到达</span><br><span class="line">qpos = franka.inverse_kinematics(</span><br><span class="line">    link = end_effector,</span><br><span class="line">    pos  = np.array([0.65, 0.0, 0.135]),</span><br><span class="line">    quat = np.array([0, 1, 0, 0]),</span><br><span class="line">)</span><br><span class="line">franka.control_dofs_position(qpos[:-2], motors_dof)</span><br><span class="line">for i in range(100):</span><br><span class="line">    scene.step()</span><br><span class="line"></span><br><span class="line"># 抓取</span><br><span class="line">franka.control_dofs_position(qpos[:-2], motors_dof)</span><br><span class="line">franka.control_dofs_force(np.array([-1, -1]), fingers_dof)</span><br><span class="line"></span><br><span class="line">for i in range(100):</span><br><span class="line">    scene.step()</span><br><span class="line"></span><br><span class="line"># 抬起</span><br><span class="line">qpos = franka.inverse_kinematics(</span><br><span class="line">    link=end_effector,</span><br><span class="line">    pos=np.array([0.65, 0.0, 0.3]),</span><br><span class="line">    quat=np.array([0, 1, 0, 0]),</span><br><span class="line">)</span><br><span class="line">franka.control_dofs_position(qpos[:-2], motors_dof)</span><br><span class="line">for i in range(200):</span><br><span class="line">    scene.step()</span><br></pre></td></tr></table></figure>
<h2 id="调试">调试</h2>
<ol type="1">
<li><code>pip install ipython</code></li>
</ol>
<p>有bug,终止交易.等作者改</p>
<h1 id="entity">entity</h1>
<h2 id="物体模型">物体模型</h2>
<h3 id="内部模型">内部模型</h3>
<h4 id="xmlmjcf">xml(MJCF)</h4>
<p>根据代码 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">franka = scene.add_entity(</span><br><span class="line">    gs.morphs.MJCF(</span><br><span class="line">        file  = <span class="string">&#x27;xml/franka_emika_panda/panda.xml&#x27;</span>,</span><br><span class="line">        pos   = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">        euler = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">45</span>), <span class="comment"># we follow scipy&#x27;s extrinsic x-y-z rotation convention, in degrees,</span></span><br><span class="line">        <span class="comment">#     # quat  = (1.0, 0.0, 0.0, 0.0), # we use w-x-y-z convention for quaternions,</span></span><br><span class="line">        scale = <span class="number">1</span>,</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>利用<code>file</code>参数从<code>xml/</code>导入，xml从当时安装genesis的env中找。以linux为例，这个项目的xml文件在<code>work/Genesis/genesis/assets/xml</code>里面</p>
<p>除了franka_emika_panda，还有另外几个，而且panda也有好几个选项。从外部导入文件没有fixed，就设置重力为0，在Scene初始化的时候</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sim_options=gs.options.SimOptions(</span><br><span class="line">    gravity=(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>franka_emika_panda 是MJCF格式的
<ol type="1">
<li>hand.xml 就一个夹持头</li>
<li>panda_no_tendon.xml 没有腱，这是什么？</li>
<li>scene.xml 和之前的panda有区别吗</li>
</ol></li>
<li>franka_sim
<ol type="1">
<li>ball.xml 啥都没</li>
<li>bi-franka_panda.xml</li>
<li>frank_panda.xml</li>
<li>franka_panda_teleop.xml</li>
<li>franka_panda_test_convex.xml</li>
</ol></li>
<li>universal_robots_ur5e
<ol type="1">
<li>ur5e.xml 没有hand。。</li>
</ol></li>
<li>其它
<ol type="1">
<li>ant.xml 也是什么都没有</li>
<li>ant_grasp_ball.xml 有一个球</li>
<li>ant_grasp_ground.xml 也没东西</li>
<li>one_tet.xml 无</li>
<li>thin_box.xml 无</li>
<li>three_joint_link.xml 有个东西</li>
<li>two_box.xml 还是没东西</li>
<li>two_skeleton.xml 我去，什么东西跳过去了</li>
</ol></li>
</ol>
<h4 id="urdf">urdf</h4>
<p>assets文件夹里面还有其它形式的。都尝试尝试</p>
<p>尝试了下示例代码，有点困难</p>
<h3 id="外部导入">外部导入</h3>
<ol type="1">
<li>文件格式 xml</li>
<li>可以从形状原语shape primitives, meshes, URDF, MJCF, Terrain, or soft
robot description
files、网格、URDF、MJCF、地形或软体机器人描述文件中实例化Genesis实体。</li>
<li>待续，我尝试从mujoco提供的模型示例导入，失败</li>
<li>加入<code>contype="0" conaffinity="0"</code> 在xml 的&lt;geom&gt;中
可能有用吧</li>
</ol>
<h1 id="操作">操作</h1>
<p>操作流程不复杂，给pos和quat让它自计算ik就行。但问题是pos和quat可能会越界，不知道这个怎么解决。我本来想用gs
view给的上下限倒推pos的，但是很奇怪它给的get_pos的返回的都不是我想要的值。</p>
<h2 id="控制的基本流程">控制的基本流程</h2>
<ol type="1">
<li>场景搭建
<ol type="1">
<li>地面</li>
<li>机械臂</li>
<li>目标物体</li>
</ol></li>
<li>定义机械臂的关节索引和控制器参数（限制）</li>
<li>ik求解关节角度、规划运动路径、执行，最好在这里同时打开hand，就是设置qpos[:-2]最后两位的值
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">qpos = franka.inverse_kinematics(</span><br><span class="line"> link = end_effector,</span><br><span class="line"> pos  = np.array([<span class="number">0.65</span>, <span class="number">0.0</span>, <span class="number">0.25</span>]),</span><br><span class="line"> quat = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]),</span><br><span class="line"> )</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 规划运动路径</span></span><br><span class="line"> path = franka.plan_path(</span><br><span class="line">     qpos_goal     = qpos,</span><br><span class="line">     num_waypoints = <span class="number">200</span>, <span class="comment"># 2秒时长</span></span><br><span class="line"> )</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 执行规划路径</span></span><br><span class="line"> <span class="keyword">for</span> waypoint <span class="keyword">in</span> path:</span><br><span class="line">     franka.control_dofs_position(waypoint)</span><br><span class="line">     scene.step()</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 等待到达最后一个路径点</span></span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">     scene.step()</span><br></pre></td></tr></table></figure></li>
<li>ik求解向下移动到位置</li>
<li>抓取</li>
</ol>
<h2 id="怎么链接到对应关节">怎么链接到对应关节</h2>
<p>总结一下：要翻xml文件。</p>
<h3 id="franka_emika_panda的panda">franka_emika_panda的panda</h3>
<p>joint(关节)和dof(自由度)是两个相关概念。</p>
<p>以Franka机械臂为例,它的手臂有7个旋转关节,夹爪有2个平移关节,每个关节有1个自由度,总共9个自由度。更一般地,像自由关节(6自由度)或球形关节(3自由度)这样的关节有多个自由度。</p>
<h3 id="franka_simbi-franka_panda">franka_sim/bi-franka_panda</h3>
<ol type="1">
<li>不知道它几个关节几个自由度：genesis内部的可以用<code>gs view 'xml/franka_sim/bi-franka_panda.xml'</code>查看</li>
<li>现在知道它有7*2个panda joint dof 和2*2个finger joint
dof，一共18个，然后panda
joint部分是第1、3、5、7、9、11、13对应单臂，另外一半对应双臂。15、16对应单臂的夹爪。</li>
<li>好了现在开始改ikmp部分的代码。
<ol type="1">
<li>可视化，加载双臂机器人、物体、平面</li>
<li>移动机械臂关节到物体上方</li>
<li>向下移动机械臂</li>
<li>抓取</li>
</ol></li>
</ol>
<h2 id="让robot保持静止">让robot保持静止</h2>
<ol type="1">
<li>获取各joint的初始状态</li>
<li>set joint状态</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">staticqpos=franka.get_qpos()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1200</span>):</span><br><span class="line">    franka.set_qpos(staticqpos)</span><br><span class="line">    scene.step()</span><br></pre></td></tr></table></figure>
<h2 id="让动作更加平缓">让动作更加平缓</h2>
<p>之前写的动作变化太大了，看到<a
target="_blank" rel="noopener" href="https://github.com/zhouxian/genesis-speed-benchmark">benchmark</a></p>
<h1 id="录像">录像</h1>
<p><a
target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41251963/article/details/109676345">linux安装播放器</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/robotic/" rel="tag"># robotic</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/12/02/robosuite%E5%B9%B3%E5%8F%B0/" rel="prev" title="robosuite平台">
                  <i class="fa fa-angle-left"></i> robosuite平台
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/12/19/conda/" rel="next" title="conda">
                  conda <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">milong26</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
